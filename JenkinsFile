pipeline {
    agent any

        environment {
         // Set Docker Hub credentials as environment variables
         //   DOCKERHUB_USERNAME = credentials('jklipton')
            DOCKERHUB_TOKEN = credentials('dckr_pat_iOcIds0aaZ5NPJNOTx_ISt_NS9U')
         //   DOCKER_CREDENTIALS = credentials('docker-hub-pass')
            }


        tools {
          maven 'MVN_HOME'
            }

        stages{
            stage('Maven Build') {
                 steps {
                  // echo 'Here you should trigger a maven build of your application using either bat(windows) or sh(linux)'
                    sh 'mvn clean install'
                        }
                   }    
       
            stage('Docker Build'){
                    steps{
                    //    echo 'In this step you should build your docker image using the docker build command'
                    //    echo 'So you need to build an image from the WAR that you generated previously'
                    //    echo 'Remember that starting point of your image should be tomcat in order to serve the application on the web'
                        echo 'Build jklipton/devops'
                        sh "docker build -t jklipton/devops ."
                          }
                    }
        
              stage('DockerHub Push'){
                    // steps
                        //echo 'You should first login to your github account using the withCredentials synatx'
                        //echo 'And for that you need to create the appropriate credentials to access the github account in Jenkins'
                        //echo 'Then you need to push this image to the public registry dockerhub into your account'
                        //echo 'Use the docker push command'
                
                    steps {
                        script {
                            // Log in to Docker Hub using the token
                            withCredentials([string(credentialsId: 'dckr_pat_iOcIds0aaZ5NPJNOTx_ISt_NS9U', variable: 'DOCKERHUB_TOKEN')]) {
                            docker.withRegistry('https://registry.hub.docker.com', 'dockerhub-credentials-id') {
                            // Build and push Docker image
                            // sh "docker build -t your-docker-image-name ."
                            sh "docker push jklipton/devops ."
                            }
                        }

                stage('Docker Deploy'){
                    steps{
                        echo 'You should use the ansiblePlaybook syntax in order to call your playbook'
                        echo 'But before that you need to create an agent in order to execute the playbook on the Ansible controle node machine'
                        }
                   }  
                }

    }

pipeline {
    agent any

    environment {
        DOCKERHUB_TOKEN = credentials('your-dockerhub-token')
    }

    stages {
        stage('Build and Push Docker Image') {
            steps {
                script {
                    // Log in to Docker Hub using the token
                    withCredentials([string(credentialsId: 'dckr_pat_iOcIds0aaZ5NPJNOTx_ISt_NS9U', variable: 'DOCKERHUB_TOKEN')]) {
                        docker.withRegistry('https://registry.hub.docker.com', 'dockerhub-credentials-id') {
                            // Build and push Docker image
                            // sh "docker build -t your-docker-image-name ."
                            sh "docker push your-docker-image-name"
                        }
                    }
                }
            }
        }
    }

    post {
        success {
            echo 'Pipeline successful! Perform additional tasks if needed.'
        }
        failure {
            echo 'Pipeline failed. Notify or take corrective actions.'
        }
    }
}

